<!DOCTYPE html>
<html lang="en">
<head>
  <title>MapPortlet</title>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <!-- JAVACRIPT FROM UPORTAL -->
  <script type="text/javascript" src="../../js/uPortal-served/jquery-1.6.1.js"></script>
  <script type="text/javascript" src="../../js/uPortal-served/jquery-ui-1.8.13.js"></script>
  <script type="text/javascript" src="../../js/uPortal-served/fluid-all-1.4.0.js"></script>
  <!-- / JAVACRIPT FROM UPORTAL -->
  <!-- FROM SKIN.XML -->
  <script type="text/javascript" src="../../js/underscore.js"></script>
  <!--script type="text/javascript" src="../../js/underscore-min.js"></script-->
  <script type="text/javascript" src="../../js/backbone-min.js"></script>
  <script type="text/javascript" src="../../js/backbone.layoutmanager.js"></script>
  <script type="text/javascript" src="../../js/map-helper.js"></script>
  <!-- / FROM SKIN.XML -->

  <!-- APP -->
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
  
  <!--
  <script type="text/javascript" src="../../js/map-location.js"></script>
  <script type="text/javascript" src="../../js/map-locations.js"></script>
  <script type="text/javascript" src="../../js/matching-map-locations.js"></script>
  
  <script type="text/javascript" src="../../js/map-view.js"></script>
  <script type="text/javascript" src="../../js/map-search-container-view.js"></script>
  <script type="text/javascript" src="../../js/map-location-detail-view.js"></script>
  <script type="text/javascript" src="../../js/map-categories-view.js"></script>
  <script type="text/javascript" src="../../js/map-category-detail-view.js"></script>
  <script type="text/javascript" src="../../js/map.js"></script>
  -->
  <script type="text/javascript" src="../../js/map-portlet.js"></script>
  <script type="text/javascript">

    
    window.mapPortlet= new MapPortlet.init({
      target : '#N_map',
      template : '#N_map-template',
      root : 'http://map.dev/src/main/webapp/WEB-INF/jsp/map.html',
      data : '../../data/map-new.json',

      mapOptions : {

        zoom: 12,//${ zoom },
        mapTypeControl: true,//${ mapTypeControl },
        mapTypeControlOptions: {
          style: window.google.maps.MapTypeControlStyle.DEFAULT
        },
        panControl: false,//${ panControl },
        zoomControl: true,//${ zoomControl },
        zoomControlOptions: {
          style: window.google.maps.ZoomControlStyle.SMALL
        },
        scaleControl: true,//${ scaleControl },
        streetViewControl: true,//${ streetView },
        rotateControl: false,//${ rotateControl },
        overviewMapControl: false,//${ overviewControl },
        mapTypeId: window.google.maps.MapTypeId.ROADMAP
      }
    });
  </script>
  
  <link rel="stylesheet" href="../../css/uPortal.css"/>

</head>
<body id="portal" class="up fl-theme-mist">
<div id="portalPage">
  <div id="portalPageInner">
    <div id="portalPageHeader"></div>
    <div id="portalNavigation"></div>
    <div id="portalPageBody">
      <div id="portalPageBodyInner" style="overflow:hidden">
        <div id="portalPageBodyLayout">
          <div id="portalPageBodyColumns" class="columns-1">
            <div class="portal-page-column fl-container-flex75">
              <div class="portal-page-column-inner">



                <!-- TEMPLATES -->

                <!-- MAIN LAYOUT -->
                <script type="layout" id="N_map-template">
                  <div id="map-search-container"></div>
                  <div id="map-search-results"></div>
                  <div id="map-categories"></div>
                  <div id="map-category-detail"></div>
                  <div id="map-location-detail"></div>
                  <div id="map-container"></div>
                </script>
                <!-- / MAIN LAYOUT -->

                <!-- MAP VIEW -->
                <script type="template" id="N_map-view-template">
                  <div class="portlet-content" data-role="content">
                    <div class="map-display" style="width:100%; height: 500px;"></div>
                  </div>
                </script>
                <!-- / MAP VIEW -->

                <!-- MAP SEARCH FORM -->
                <script type="template" id="map-search-container-template">
                  <div data-role="header" class="titlebar portlet-titlebar">
                    <a class="map-browse-link" data-role="button" data-icon="grid" data-inline="true" href="javascript:;">Browse</a>
                    <h2>Search</h2>
                  </div>
                  <div class="portlet-content" data-role="content">
                    <form class="map-search-form" onsubmit="return false;">
                      <input class="map-search-input" autocomplete="off" type="text" data-mini="true" size="10" name="search" title="search"/>
                      <input data-role="button" data-inline="true" type="submit" value="Go"/>
                    </form>
                  </div>
                </script>
                <!-- / MAP SEARCH FORM -->

                <!-- MAP SEARCH -->
                <script type="template" id="map-search-results-template">
                  <div class="portlet-content" data-role="content">
                    <ul data-role="listview">
                      <li class="map-search-result">
                        <a href="javascript:;" class="map-search-result-link"></a>
                      </li>
                    </ul>
                  </div>
                </script>
                <!-- / MAP SEARCH -->

                <!-- MAP CATEGORIES -->
                <script type="template" id="map-categories-template">
                  <div data-role="header" class="titlebar portlet-titlebar">
                    <h2>Browse</h2>
                    <a href="javascript:;" data-role="button" class="map-search-link" data-icon="search">Search</a>
                  </div>
                  <div class="portlet-content" data-role="content">
                    <ul data-role="listview">
                      {! _.each(categories, function (i, cat) { !}
                      <li class="map-category">
                        <a href="javascript:;" class="map-category-link" data-category='{{ cat }}'>{{ cat }}</a>
                      </li>
                      {! }); !}
                    </ul>
                  </div>
                </script>
                <!-- / MAP CATEGORIES -->

                <!-- MAP CATEGORY -->
                <script type="template" id="map-category-detail-template">
                  <div data-role="header" class="titlebar portlet-titlebar search-back-div">
                    <a data-role="button"  data-icon="back" data-inline="true" class="map-category-back-link" href="javascript:;">Back</a>
                    <h2 class="map-category-name">Browse</h2>
                  </div>

                  <div class="portlet">
                    <div class="portlet-content" data-role="content">
                      <ul data-role="listview">
                        {! locations.each( function (location) { !}
                        <li class="map-location">
                          <a href="javascript:;" class="map-location-link" data-locationid="{{ location.get('id') }}">{{ location.get('name') }}</a>
                        </li>
                        {! }); !}
                      </ul>
                    </div>
                  </div>
                </script>
                <!-- / MAP CATEGORY -->

                <!-- MAP LOCATION -->
                <script type="template" id="map-location-detail-template">
                  <div data-role="header" class="titlebar portlet-titlebar search-back-div">
                    <a data-role="button"  data-icon="back" data-inline="true" class="map-location-back-link" href="javascript:;">Back</a>
                    <h2 class="map-location-name">{{ location.name }}</h2>
                  </div>

                  <div class="portlet">
                    <div class="portlet-content" data-role="content">
                      <h3 class="map-location-name">{{ location.name }}</h3>
                      <p class="map-location-description">{{ location.description != null ? location.description : '' }}</p>
                      <p class="map-location-address">{{ location.address }}</p>
                      <p>
                        <a href="http://maps.google.com?q={{ encodeURI( location.address ? location.address : location.latitude + ',' + location.longitude ) }}" class="map-location-directions-link" target="javascript:;">Directions</a>
                      </p>
                      {! if( location.latitude != null && location.longitude != null ) { !}
                      <p><a class="map-location-map-link" href="javascript:;">View in Map</a>
                        {! } !}
                        {! if( location.img ) { !}
                      <p><img class="map-location-image" src="{{ location.img }}"/></p>
                      {! } !}
                    </div>
                  </div>
                </script>
                <!-- / MAP LOCATION -->

                <!-- / TEMPLATES -->

                <div id="N_map"></div>


              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
